{"version":3,"sources":["config/passport.js"],"names":[],"mappings":";;;;AAIA;;;;AACA;;;;AACA;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sBAAS,GAAT,CAAa,OAAb,EAAsB,4BAAa;AAC/B,mBAAe,UADgB;AAE/B,mBAAe;AAFgB,CAAb;AAAA,gEAGnB,iBAAO,QAAP,EAAiB,QAAjB,EAA2B,IAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAEwB,eAAK,OAAL,CAAa,EAAE,kBAAF,EAAb,CAFxB;;AAAA;AAEW,4BAFX;;AAAA,4BAGU,IAHV;AAAA;AAAA;AAAA;;AAAA,yDAIgB,KAAK,IAAL,EAAW,KAAX,CAJhB;;AAAA;AAAA;AAAA;AAAA,+BAO+B,KAAK,gBAAL,CAAsB,QAAtB,CAP/B;;AAAA;AAOe,+BAPf;;AAAA,4BAQc,OARd;AAAA;AAAA;AAAA;;AAAA,yDASoB,KAAK,IAAL,EAAW,KAAX,CATpB;;AAAA;AAWS,6BAAK,IAAL,EAAW,IAAX;AAXT;AAAA;;AAAA;AAAA;AAAA;;AAaS;;AAbT;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,yDAiBY,iBAjBZ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAHmB;;AAAA;AAAA;AAAA;AAAA,IAAtB,E,CArBA","file":"config/passport.js","sourcesContent":["/**\n * Created by Bell on 16/8/10.\n */\n\nimport passport from 'koa-passport';\nimport User from '../models/user';\nimport { Strategy } from 'passport-local';\n\n// passport.serializeUser((user, done) => {\n//     done(null, user.id);\n// });\n//\n// passport.deserializeUser(async (id, done) => {\n//     try {\n//         const user = await User.findById(id, '-password');\n//         done(null, user);\n//     } catch (err) {\n//         done(err);\n//     }\n// });\n\npassport.use('local', new Strategy({\n    usernameField: 'username',\n    passwordField: 'password'\n}, async (username, password, done) => {\n    try {\n        const user = await User.findOne({ username });\n        if (!user) {\n            return done(null, false);\n        }\n        try {\n            const isMatch = await user.validatePassword(password);\n            if (!isMatch) {\n                return done(null, false);\n            }\n            done(null, user);\n        } catch (err) {\n            done(err);\n        }\n\n    } catch (err) {\n        return done(err);\n    }\n}));\n"],"sourceRoot":"/source/"}