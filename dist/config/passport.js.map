{"version":3,"sources":["config/passport.js"],"names":[],"mappings":";;;;AAIA;;;;AACA;;;;AACA;;;;AAEA,sBAAS,aAAT,CAAuB,UAAC,IAAD,EAAO,IAAP,EAAgB;AACnC,SAAK,IAAL,EAAW,KAAK,EAAhB;AACH,CAFD,E,CARA;;;;AAYA,sBAAS,eAAT;AAAA,gEAAyB,iBAAO,EAAP,EAAW,IAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAEE,eAAK,QAAL,CAAc,EAAd,EAAkB,WAAlB,CAFF;;AAAA;AAEX,4BAFW;;AAGjB,6BAAK,IAAL,EAAW,IAAX;AAHiB;AAAA;;AAAA;AAAA;AAAA;;AAKjB;;AALiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAzB;;AAAA;AAAA;AAAA;AAAA;;AASA,sBAAS,GAAT,CAAa,OAAb,EAAsB,4BAAa;AAC/B,mBAAe,UADgB;AAE/B,mBAAe;AAFgB,CAAb;AAAA,iEAGnB,kBAAO,QAAP,EAAiB,QAAjB,EAA2B,IAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAEwB,eAAK,OAAL,CAAa,EAAE,kBAAF,EAAb,CAFxB;;AAAA;AAEW,4BAFX;;AAAA,4BAGU,IAHV;AAAA;AAAA;AAAA;;AAAA,0DAIgB,KAAK,IAAL,EAAW,KAAX,CAJhB;;AAAA;AAAA;AAAA;AAAA,+BAO+B,KAAK,gBAAL,CAAsB,QAAtB,CAP/B;;AAAA;AAOe,+BAPf;;AAAA,4BAQc,OARd;AAAA;AAAA;AAAA;;AAAA,0DASoB,KAAK,IAAL,EAAW,KAAX,CATpB;;AAAA;AAWS,6BAAK,IAAL,EAAW,IAAX;AAXT;AAAA;;AAAA;AAAA;AAAA;;AAaS;;AAbT;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,0DAiBY,kBAjBZ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAHmB;;AAAA;AAAA;AAAA;AAAA,IAAtB","file":"config/passport.js","sourcesContent":["/**\n * Created by Bell on 16/8/10.\n */\n\nimport passport from 'koa-passport';\nimport User from '../models/user';\nimport { Strategy } from 'passport-local';\n\npassport.serializeUser((user, done) => {\n    done(null, user.id);\n});\n\npassport.deserializeUser(async (id, done) => {\n    try {\n        const user = await User.findById(id, '-password');\n        done(null, user);\n    } catch (err) {\n        done(err);\n    }\n});\n\npassport.use('local', new Strategy({\n    usernameField: 'username',\n    passwordField: 'password'\n}, async (username, password, done) => {\n    try {\n        const user = await User.findOne({ username });\n        if (!user) {\n            return done(null, false);\n        }\n        try {\n            const isMatch = await user.validatePassword(password);\n            if (!isMatch) {\n                return done(null, false);\n            }\n            done(null, user);\n        } catch (err) {\n            done(err);\n        }\n\n    } catch (err) {\n        return done(err);\n    }\n}));\n"],"sourceRoot":"/source/"}